# FOREWARNS workflow

These files comprise the workflow necessary to generateg FOREWARNS flood forecasts and proxies. FOREWARNS is described here: https://nhess.copernicus.org/preprints/nhess-2023-83/ . The workflow routines are the shell scripts
  * master.sh $date $init (forecast generation workflow; date and hour of forecast initialisation)
  * obs_master.sh $date (observations and flood forecast evaluation workflow; date of desired evaluation day)
  
The entire configuration is designed to be usable by a new user just by modifying directory variables ${gws_dir} and ${user_dir} within these shell scripts. However flood forecasts do have file dependencies, described below, which are also required. Post-processed rainfall forecasts can be generated without these.

The workflows and all files called upon therein depend critically upon the following directory structure.
Note that the structure is designed for use on the UK STFC JASMIN server; here gws_dir sits on a group-workspace disk (not backed-up, high storage disk), while 
user_dir sits in a user's home area (backed-up, lower storage capacity). Folders in <..> will be generated by the workflow.

gws_dir\
|--> mogreps_ensembles
> |--> <%Y%m>

|--> processed_forecasts
> |--> <%Y%m>
> > |--> <%Y%m%d_%H>

|--> flood_forecasts
> |--> RainfallReferenceFiles\
> |--> Shapefile\
> |--> rainfall_inputs
> > |--> <%Y%m%d>\
> > |--> radar
> > > |--> <%Y%m%d>

|--> radar_obs
> |--> <%Y>\
> |--> processed_radar
> > |--> <%Y%m%d_00>

user_dir (Note this is where all scripts should sit)\
|--> output_plots
> |--> evaluation\
> |--> forecasts\
> |--> radar

A copy of this directory structure is provided. RainfallReferenceFiles and Shapefile contain files needed to generate flood forecasts; these are: 
  * An example list of catchment fid's and sample coordinates on UK OSNG (dir RainfallReferenceFiles), in format required by scripts. Catchments used in development were England + Wales HydroBasins L9 dataset; obtain HydroBasins catchment data from  https://www.hydrosheds.org/products/hydrobasins .
  * Example DUMMY rainfall threshold values for catchment level flood return periods. True data values should be used for accurate forecasts; for UK obtain FEH modelling data from https://fehweb.ceh.ac.uk/ . 
  * Reference shapefile (GeoPlots) for enabling common return period legends (dir Shapefile).

Note that scripts are currently set to use dummy flood reference values; to change this, modify variable "refs" in extract_catchment_fcsts.py (l68) and FloodForecastLookup.py (l379). Flood forecasts will not run without catchment data noted above.
